<!doctype html><html lang=en><head><title>a n title</title><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1" name=viewport><meta content=noodp name=robots><link href=https://aniewoehner.github.io/blog/style.css rel=stylesheet><link href=https://aniewoehner.github.io/blog/color/orange.css rel=stylesheet><link href=https://aniewoehner.github.io/blog/color/background_dark.css rel=stylesheet><link href=https://aniewoehner.github.io/blog/font-hack.css rel=stylesheet><link href=https://aniewoehner.github.io/blog/rss.xml rel=alternate title=RSS type=application/rss+xml><link rel="shortcut icon" href=favicon-32x32.png type=image/png><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a style="text-decoration: none;" href=https://aniewoehner.github.io/blog> <div class=logo>My blog</div> </a></div></div><nav class=menu><ul class=menu__inner><li class=active><a href=https://aniewoehner.github.io/blog/>Home</a><li><a href=https://aniewoehner.github.io/blog/projects/>Projects</a><li><a href=https://aniewoehner.github.io/blog/blog/>Blog</a><li><a href=https://aniewoehner.github.io/blog/tags/>Tags</a><li><a href=https://aniewoehner.github.io/blog/links/>Links</a><li><a href=https://aniewoehner.github.io/blog/about>Contact/About</a><li><a rel="noopener noreferrer" href=https://github.com/aniewoehner target=_blank>github</a></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=https://aniewoehner.github.io/blog/pages/esphome/esphome/>esphome</a></h1><div class=post-meta-inline><span class=post-date> 2022-12-05 </span></div><span class=post-tags-inline> :: tags:  <a class=post-tag href=https://aniewoehner.github.io/blog/tags/computer/>#computer</a>  <a class=post-tag href=https://aniewoehner.github.io/blog/tags/hardware/>#hardware</a>  <a class=post-tag href=https://aniewoehner.github.io/blog/tags/firmware/>#firmware</a></span><div class=post-content><p>framework for IoT using Espressif esp32 and/or other similar hardware alternative framework: [[tasmota]] <a href=/tasmota>tasmota</a> example of camera: [[zola_blog_content/computer/espcam]] <a href=espcam>espcam</a> <a href=esp32-cam></a><h2 id=why>why</h2><p>esphome replacing tasmota<ul><li>allows better integration with home assistant<li>allows actions that do not require the controller?<li>builds using python<li>next steps:<li>newest esphome requires newer python than on renegade/201 <ul><li>build firmware elsewhere<li>possible to program from renegade/201?</ul><li>Can migrate between Tasmota and esphome, firmware is uploadable through the web interface <ul><li>Insufficient space? Use the gzip version of the firmware.bin</ul></ul><h1 id=building>Building</h1><ul><li>Use a python virtual environment to be able to maintain versions of libraries</ul><pre class=language-sh data-lang=sh style=background-color:#151515;color:#e8e8d3;><code class=language-sh data-lang=sh><span style=color:#ffb964;>python</span><span> venv
</span><span>source py /bin/activate
</span><span style=color:#8fbfdc;>export </span><span style=color:#ffb964;>PIP_CACHE_DIR</span><span>=&LTpath>
</span><span style=color:#ffb964;>python3 -m</span><span> pip install</span><span style=color:#ffb964;> --upgrade</span><span> pip
</span><span style=color:#ffb964;>python3 -m</span><span> pip install</span><span style=color:#ffb964;> --upgrade</span><span> wheel
</span><span style=color:#ffb964;>PLATFORMIO_CORE_DIR</span><span>=</span><span style=color:#99ad6a;>$( pwd )/dot_platformio
</span><span style=color:#8fbfdc;>export </span><span style=color:#ffb964;>PLATFORMIO_CORE_DIR
</span><span style=color:#ffb964;>mkdir -p </span><span>${</span><span style=color:#ffb964;>PLATFORMIO_CORE_DIR</span><span>}
</span><span style=color:#ffb964;>python3 -m</span><span> pip install</span><span style=color:#ffb964;> --upgrade</span><span> esphome
</span><span style=color:#ffb964;>this</span><span> brings in platformio?
</span><span style=color:#ffb964;>pio</span><span> upgrade?
</span></code></pre><ul><li>Or container image</ul><pre class=language-sh data-lang=sh style=background-color:#151515;color:#e8e8d3;><code class=language-sh data-lang=sh><span style=color:#ffb964;>docker</span><span> run</span><span style=color:#ffb964;> --rm --net</span><span>=host</span><span style=color:#ffb964;> -v </span><span style=color:#556633;>"</span><span style=color:#99ad6a;>${</span><span style=color:#ffb964;>PWD</span><span style=color:#99ad6a;>}</span><span style=color:#556633;>"</span><span>:/config</span><span style=color:#ffb964;> -it</span><span> esphome/esphome
</span></code></pre><ul><li>Start building a basic configuration yaml for a device by using the wizard</ul><pre class=language-sh data-lang=sh style=background-color:#151515;color:#e8e8d3;><code class=language-sh data-lang=sh><span style=color:#ffb964;>esphome</span><span> wizard &LTdevicename>.yaml
</span></code></pre><ul><li><p>Edit that yaml</p><li><p>Build</p></ul><pre class=language-sh data-lang=sh style=background-color:#151515;color:#e8e8d3;><code class=language-sh data-lang=sh><span style=color:#ffb964;>esphome</span><span> compile <>.yaml
</span></code></pre><pre style=background-color:#151515;color:#e8e8d3;><code><span>- Older versions used esphome yaml compile
</span></code></pre><ul><li>Firmware produced will be in ./.esphome/build/<node>/.pioenvs/<node>/firmware.bin<li><ul><p><a href=https://esphome.io/guides/configuration-types.html#config-substitutions>https://esphome.io/guides/configuration-types.html#config-substitutions</a> esphome config <>.yaml<pre class=language-sh data-lang=sh style=background-color:#151515;color:#e8e8d3;><code class=language-sh data-lang=sh><span style=color:#ffb964;>sourc</span><span> ed venv
</span><span style=color:#ffb964;>python3 -m</span><span> pip install</span><span style=color:#ffb964;> --upgrade</span><span> pip
</span><span style=color:#ffb964;>python3 -m</span><span> pip install</span><span style=color:#ffb964;> --upgrade</span><span> wheel
</span><span style=color:#ffb964;>python3 -m</span><span> pip install</span><span style=color:#ffb964;> --upgrade</span><span> cryptography
</span><span style=color:#ffb964;>python3 -m</span><span> pip install</span><span style=color:#ffb964;> --upgrade</span><span> esphome
</span><span>
</span><span style=color:#ffb964;>esphome</span><span> version
</span><span>
</span><span style=color:#ffb964;>esphome</span><span> wizard <>.yaml
</span><span>	</span><span style=color:#ffb964;>like</span><span> device_name
</span><span style=color:#ffb964;>esphome</span><span> wizard sonoff_s31_01.yaml
</span><span>	</span><span style=color:#ffb964;>asks</span><span> name, give it the same name
</span><span>	</span><span style=color:#ffb964;>esp8266</span><span> platform for all sonoff?
</span><span>	</span><span style=color:#ffb964;>but</span><span> then esp8285 board?
</span></code></pre><p>serial console adapter for rock64 default is 1.5M baud, why? 3v3 signaling but some sort of problem prevents boot serial@ff13000<h3 id=advanced-sensor-creation>Advanced sensor creation</h3><ul><li>generally falls under the idea of template based sensor and follows home assistant</ul><pre class=language-yaml data-lang=yaml style=background-color:#151515;color:#e8e8d3;><code class=language-yaml data-lang=yaml><span>- </span><span style=color:#ffb964;>platform</span><span>: </span><span style=color:#99ad6a;>template
</span><span>  </span><span style=color:#ffb964;>sensors</span><span>:
</span><span>    </span><span style=color:#ffb964;>something_state</span><span>:
</span><span>      </span><span style=color:#ffb964;>friendly_name</span><span>: </span><span style=color:#99ad6a;>something_status
</span><span>      </span><span style=color:#ffb964;>value_template</span><span>: </span><span style=color:#8fbfdc;>>-
</span><span style=color:#99ad6a;>      {% if
</span><span style=color:#99ad6a;>      (states()|int >= 5 and (as_timestamp(now())-(as_timestamp(states))))
</span><span style=color:#99ad6a;>      %}
</span><span style=color:#99ad6a;>        on
</span><span style=color:#99ad6a;>      {% else %}
</span><span style=color:#99ad6a;>        off
</span><span style=color:#99ad6a;>      {% endif %}
</span></code></pre><div></div><div class="post on-list"><h1 class=post-title><a href=https://aniewoehner.github.io/blog/pages/esphome/config/esp32-c3/>esp32-c3</a></h1><div class=post-meta-inline><span class=post-date> 2022-12-12 </span></div><span class=post-tags-inline> :: tags:  <a class=post-tag href=https://aniewoehner.github.io/blog/tags/computer/>#computer</a></span><div class=post-content><p>esp32-c3<pre class=language-yaml data-lang=yaml style=background-color:#151515;color:#e8e8d3;><code class=language-yaml data-lang=yaml><span style=color:#ffb964;>esphome</span><span>:
</span><span>  </span><span style=color:#ffb964;>name</span><span>: </span><span style=color:#99ad6a;>test
</span><span>  </span><span style=color:#ffb964;>platform</span><span>: </span><span style=color:#99ad6a;>ESP32
</span><span>  </span><span style=color:#ffb964;>board</span><span>: </span><span style=color:#99ad6a;>esp32dev
</span><span>  </span><span style=color:#ffb964;>platformio_options</span><span>:
</span><span>    </span><span style=color:#ffb964;>platform</span><span>: </span><span style=color:#99ad6a;>espressif32
</span><span>    </span><span style=color:#ffb964;>board</span><span>: </span><span style=color:#99ad6a;>esp32-c3-devkitm-1
</span><span>    </span><span style=color:#ffb964;>board_build.mcu</span><span>: </span><span style=color:#99ad6a;>esp32c3
</span><span>    </span><span style=color:#ffb964;>board_build.f_cpu</span><span>: </span><span style=color:#99ad6a;>160000000L
</span><span>    </span><span style=color:#ffb964;>upload_protocol</span><span>: </span><span style=color:#99ad6a;>esptool
</span><span>    </span><span style=color:#ffb964;>build_flags</span><span>:
</span><span>      - </span><span style=color:#99ad6a;>-D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC
</span><span>      - </span><span style=color:#99ad6a;>-D USBCON
</span></code></pre></div></div><div class="post on-list"><h1 class=post-title><a href=https://aniewoehner.github.io/blog/pages/esphome/esp-hardware/>esp hardware</a></h1><div class=post-meta-inline><span class=post-date> 2022-12-12 </span></div><span class=post-tags-inline> :: tags:  <a class=post-tag href=https://aniewoehner.github.io/blog/tags/computer/>#computer</a>  <a class=post-tag href=https://aniewoehner.github.io/blog/tags/hardware/>#hardware</a>  <a class=post-tag href=https://aniewoehner.github.io/blog/tags/firmware/>#firmware</a></span><div class=post-content><p>esp8266 vs esp32 8266 has some advantages using unsecured access point, not going to do that for secured (WPAx) access point, esp32 has advantage<p>ESP32 - 2016 - plain - Wi-Fi 4, bt 4.2<ul><li><p>ESP32-C6 - 2021 - 32-bit RISC-V, 2.4 GHz Wi-Fi 6, Bt (LE) 5, IEEE 802.15.4, nothing found?</p> <ul><li>mini and wroom</ul><li><p>ESP32-C3 - 2020 - 32-bit RISC-V &LT160MHz, 2.4 GHz Wi-Fi, Bt (LE) 5, 400 kB SRAM 384 kB ROM, spi/qpi, $10 for one</p> <ul><li>mini and wroom</ul><li><p>ESP32-C2 - - 32-bit RISC-V &LT120MHz, 2.4 GHz Wi-Fi, Bt (LE) 5, 272 kB SRAM, 16kB cache, 576 kB ROM, nothing found?</p> <ul><li>mini and wroom</ul><li><p>ESP32-S3 - 2020 - 32-bit LX7, 2.4 GHz Wi-Fi, Bt (LE) 5, 3 for $20</p> <ul><li>mini and wroom</ul><li><p>ESP32-S2 - 2019 - 32-bit LX7, 2.4 GHz Wi-Fi, 3 for $15</p> <ul><li>mini and solo, wrover and wroom not rec for new design,</ul><li><p>supposedly S2 is much more energy efficient, adds a different camera interface</p><li><p>S2, C3, S3 have native USB, no need for usb-to-serial chip</p><li><p>RISC-V are lower cost</p><li><p>S3 is like updated ESP32, higher specs</p><li><p>WROOM - does not use the 2 GPIOs</p><li><p>WROVER - has 8MB SPI PSRAM chip + ESP32-D0WDQ6, 2 GPIOs used for the ram <a href=https://www.espressif.com/en/products/modulesmini>https://www.espressif.com/en/products/modulesmini</a> <a href=https://docs.espressif.com/projects/esp-idf/en/latest/hw-reference/index.html>https://docs.espressif.com/projects/esp-idf/en/latest/hw-reference/index.html</a></p></ul><h1 id=lolin>lolin</h1><ul><li><p>DoHome ESP-C3 5.99</p> <ul><li><a href=https://www.amazon.com/DoHome-Development-Dual-Mode-Microcontroller-Integrated/dp/B09HC2SRNP/>https://www.amazon.com/DoHome-Development-Dual-Mode-Microcontroller-Integrated/dp/B09HC2SRNP/</a></ul><li><p>ESP-C3-12F $8.99</p> <ul><li><a href=https://www.amazon.com/JacobsParts-ESP-C3-12F-ESP32-C3-Bluetooth-Development/dp/B09B7Y2VKR/>https://www.amazon.com/JacobsParts-ESP-C3-12F-ESP32-C3-Bluetooth-Development/dp/B09B7Y2VKR/</a></ul><li><p>ESP32-C3-DevKitM-1 $8.00</p> <p>c3-mini-1-n4</p> <ul><li><p><a href=https://www.amazon.com/Espressif-ESP32-C3-DevKitM-1-Development-Board/dp/B08W2J9B8J/>https://www.amazon.com/Espressif-ESP32-C3-DevKitM-1-Development-Board/dp/B08W2J9B8J/</a></p><li><p><a href="https://www.mouser.com/ProductDetail/Espressif-Systems/ESP32-C3-DevKitM-1?qs=pUKx8fyJudB1sOWbbEnGFw%3D%3D">https://www.mouser.com/ProductDetail/Espressif-Systems/ESP32-C3-DevKitM-1?qs=pUKx8fyJudB1sOWbbEnGFw%3D%3D</a></p></ul><li><p>3x ESP32-C3-DevKitM-1 for 13.88</p> <ul><li><a href=https://www.amazon.com/Teyleten-Robot-ESP32-C3-DevKitM-1-Development-Bluetooth/dp/B0B6HT7L9L/>https://www.amazon.com/Teyleten-Robot-ESP32-C3-DevKitM-1-Development-Bluetooth/dp/B0B6HT7L9L/</a></ul><li><p>ESP32-C3-DevKitC-02 $8.00</p> <p>ESP32-C3-WROOM-02-N4</p> <ul><li><p><a href=https://www.amazon.com/Espressif-ESP32-C3-DevKitC-02-Development-Board/dp/B09D3S4RPZ/>https://www.amazon.com/Espressif-ESP32-C3-DevKitC-02-Development-Board/dp/B09D3S4RPZ/</a></p><li><p><a href="https://www.mouser.com/ProductDetail/Espressif-Systems/ESP32-C3-DevKitC-02?qs=stqOd1AaK7%2F1Q62ysr4CMA%3D%3D">https://www.mouser.com/ProductDetail/Espressif-Systems/ESP32-C3-DevKitC-02?qs=stqOd1AaK7%2F1Q62ysr4CMA%3D%3D</a></p></ul><li><p>ESP32-C3-DevKitC-02U $9.80</p> <p>ESP32-C3-WROOM-02U-N4</p> <ul><li><p><a href=https://www.amazon.com/Espressif-ESP32-C3-DevKitC-02U-Development-Board/dp/B09D3TGJGD/>https://www.amazon.com/Espressif-ESP32-C3-DevKitC-02U-Development-Board/dp/B09D3TGJGD/</a></p><li><p><a href="https://www.mouser.com/ProductDetail/Espressif-Systems/ESP32-C3-DevKitC-02U?qs=Wj%2FVkw3K%252BMATroZS6qcRPw%3D%3D">https://www.mouser.com/ProductDetail/Espressif-Systems/ESP32-C3-DevKitC-02U?qs=Wj%2FVkw3K%252BMATroZS6qcRPw%3D%3D</a></p></ul><li><p>ESP32-C3-DevKitM-1U $9.80</p> <p>https://www.amazon.com/Espressif-ESP32-C3-DevKitM-1U-Development-Board/dp/B09D3THNXK/ref=sr_1_10?keywords=ESP32-C3&link_code=qs&qid=1670587675&sourceid=Mozilla-search&sr=8-10 https://www.mouser.com/ProductDetail/Espressif-Systems/ESP32-C3-DevKitM-1U?qs=Wj%2FVkw3K%252BMBXW0wbfKCpog%3D%3D ESP32-C3-MINI-1U</p></ul><p>s2 mini may not use esphome, may be waiting for esphome to catch up to platformio 4.3<ul><li><p>s2 mini 2 for $13.99</p> <ul><li><a href=https://www.amazon.com/dp/B0BBGKJNV5>https://www.amazon.com/dp/B0BBGKJNV5</a></ul><li><p>s2 mini hiletgo 3 for $15.49</p> <ul><li><a href=https://www.amazon.com/dp/B0B291LZ99>https://www.amazon.com/dp/B0B291LZ99</a></ul><li><p>ESP32 S2 Mini ESP32-S2FN4R2 ESP32-S2 1 for 3 for 5 for $23.99</p> <ul><li><a href=https://www.amazon.com/dp/B0B2ZWZWLW>https://www.amazon.com/dp/B0B2ZWZWLW</a></ul></ul><p>s2 mini<p>have to press 0 button, tap reset button in order to fire up cdc_acm serial port</div></div><div class="post on-list"><h1 class=post-title><a href=https://aniewoehner.github.io/blog/pages/esphome/config/lolin-c3/>lolin c3</a></h1><div class=post-meta-inline><span class=post-date> 2022-12-12 </span></div><span class=post-tags-inline> :: tags:  <a class=post-tag href=https://aniewoehner.github.io/blog/tags/computer/>#computer</a></span><div class=post-content><p>lolin c3<pre class=language-yaml data-lang=yaml style=background-color:#151515;color:#e8e8d3;><code class=language-yaml data-lang=yaml><span style=color:#ffb964;>esphome</span><span>:
</span><span>  </span><span style=color:#ffb964;>name</span><span>: </span><span style=color:#99ad6a;>lolin-c3-1_0_0
</span><span>  </span><span style=color:#ffb964;>platformio_options</span><span>:
</span><span>    </span><span style=color:#ffb964;>board_build.flash_mode</span><span>: </span><span style=color:#99ad6a;>dio
</span><span>
</span><span style=color:#ffb964;>esp32</span><span>:
</span><span>  </span><span style=color:#ffb964;>board</span><span>: </span><span style=color:#99ad6a;>esp32-c3-devkitm-1
</span><span>  </span><span style=color:#ffb964;>variant</span><span>: </span><span style=color:#99ad6a;>ESP32C3
</span><span>  </span><span style=color:#ffb964;>framework</span><span>:
</span><span>    </span><span style=color:#ffb964;>type</span><span>: </span><span style=color:#99ad6a;>esp-idf
</span><span>    </span><span style=color:#ffb964;>sdkconfig_options</span><span>:
</span><span>      </span><span style=color:#ffb964;>CONFIG_ESP_TASK_WDT_TIMEOUT_S</span><span>: </span><span style=color:#556633;>"</span><span style=color:#99ad6a;>10</span><span style=color:#556633;>"
</span><span>      </span><span style=color:#ffb964;>CONFIG_BT_BLE_50_FEATURES_SUPPORTED</span><span>: y
</span><span>      </span><span style=color:#ffb964;>CONFIG_BT_BLE_42_FEATURES_SUPPORTED</span><span>: y
</span><span>
</span><span style=color:#ffb964;>wifi</span><span>:
</span><span>  </span><span style=color:#ffb964;>ssid</span><span>: </span><span style=color:#8fbfdc;>!secret </span><span style=color:#99ad6a;>wifi_ssid
</span><span>  </span><span style=color:#ffb964;>password</span><span>: </span><span style=color:#8fbfdc;>!secret </span><span style=color:#99ad6a;>wifi_password
</span><span>  </span><span style=color:#ffb964;>output_power</span><span>: </span><span style=color:#cf6a4c;>8.5  </span><span style=color:#888888;># will result in a bootloop otherwise
</span><span>
</span><span style=color:#ffb964;>esp32_ble_tracker</span><span>:
</span><span style=color:#888888;># bluetooth_proxy:  will result in a non reactive state
</span></code></pre></div></div><div class="post on-list"><h1 class=post-title><a href=https://aniewoehner.github.io/blog/pages/esphome/config/lolin-s2-mini/>lolin s2 mini</a></h1><div class=post-meta-inline><span class=post-date> 2022-12-12 </span></div><span class=post-tags-inline> :: tags:  <a class=post-tag href=https://aniewoehner.github.io/blog/tags/computer/>#computer</a></span><div class=post-content><p>lolin s2 mini<pre class=language-yaml data-lang=yaml style=background-color:#151515;color:#e8e8d3;><code class=language-yaml data-lang=yaml><span style=color:#ffb964;>esphome</span><span>:
</span><span>  </span><span style=color:#ffb964;>name</span><span>: </span><span style=color:#99ad6a;>lolin-s2-1_0_0
</span><span>  </span><span style=color:#ffb964;>platformio_options</span><span>:   
</span><span>    </span><span style=color:#ffb964;>board_build.mcu</span><span>: </span><span style=color:#99ad6a;>esp32s2
</span><span>
</span><span style=color:#ffb964;>esp32</span><span>:
</span><span>  </span><span style=color:#ffb964;>board</span><span>: </span><span style=color:#99ad6a;>lolin_s2_mini
</span><span>  </span><span style=color:#ffb964;>variant</span><span>: </span><span style=color:#99ad6a;>ESP32S2
</span><span>  </span><span style=color:#ffb964;>framework</span><span>:
</span><span>    </span><span style=color:#ffb964;>type</span><span>: </span><span style=color:#99ad6a;>esp-idf
</span><span>    </span><span style=color:#ffb964;>platform_version</span><span>: </span><span style=color:#99ad6a;>https://github.com/jhamhader/platform-espressif32#8bc085573e4f6986ffcda7050b9607739f3c6976
</span></code></pre></div></div><div class=pagination><div class=pagination__buttons></div></div><div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user">My custom <b>copyright</b></div></div></footer><div>